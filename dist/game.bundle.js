(()=>{let e,t,n,o=document.querySelector("canvas"),i=o.getContext("2d"),d=document.querySelector(".start"),l=document.querySelector(".score"),c=0,r=0,h=0,u=7,a=u,w=0,f=.02*o.width,s=f,m=20,y=40,p=[],g=document.querySelector(".block-1"),v=new Audio("../sounds/bonus.mp3"),M=new Audio("../sounds/game-over.mp3"),A=new Audio("../sounds/menu-button.mp3"),L=new Audio("../sounds/phone.mp3"),S=!1;L.loop=!0,L.play(),g.addEventListener("touchmove",(function(e){if(e.preventDefault(),!E||!b)return;let t=e.touches[0],n=t.clientX-E,o=t.clientY-b;Math.abs(n)>Math.abs(o)?n>0?(a=7,w=0):(a=-7,w=0):o>0?(a=0,w=7):(a=0,w=-7),E=null,b=null})),g.addEventListener("touchstart",(function(e){let t=e.touches[0];E=t.clientX,b=t.clientY}));let E=null,b=null;function q(){a=u*(o.width/800),w=u*(o.height/600)}function x(){(r>=o.width-f||r<0||h>=o.height-s||h<0)&&(M.play(),clearInterval(n),alert("Вы умерли, ваш счёт "+c),S=!1,c=0,u=7,a=u,w=0,r=0,h=0,p=[],y=40,R()),i.clearRect(0,0,o.width,o.height),p.unshift({x:r,y:h}),p.length>y/f&&p.pop();for(let e=0;e<p.length;e++)i.fillRect(p[e].x,p[e].y,f,s);r=(r+a+o.width)%o.width,h=(h+w+o.height)%o.height,i.fillStyle="red",i.fillRect(e,t,m,m),r<e+m&&r+f>e&&h<t+m&&h+s>t&&(D(),y+=50,i.fillRect(p,h,f,s),c++,v.play(),R())}function D(){let n=o.width-m-20,i=o.height-m-20;t=Math.floor(Math.random()*i)+10,e=Math.floor(Math.random()*n)+10}function R(){l.textContent=c%10==1&&c%100!=11?"Вы собрали "+c+" яблоко":c%10>=2&&c%10<=4&&!(c%100>=12&&c%100<=14)?"Вы собрали "+c+" яблока":"Вы собрали "+c+" яблок"}function k(){o.width=window.innerWidth,o.height=window.innerHeight,f=.02*o.width,s=.02*o.width,m=.03*o.width,e=Math.floor(Math.random()*o.width),t=Math.floor(Math.random()*o.height),q(),D()}i.fillStyle="green",window.addEventListener("resize",(function(){k(),D(),q(),n=setInterval(x,40)})),document.addEventListener("keydown",(function(e){e.preventDefault(),"KeyS"==e.code||"ArrowDown"==e.code?(w=7,a=0):"KeyD"==e.code||"ArrowRight"==e.code?(a=7,w=0):"KeyA"==e.code||"ArrowLeft"==e.code?(a=-7,w=0):"KeyW"!=e.code&&"ArrowUp"!=e.code||(w=-7,a=0)})),d.addEventListener("click",(function(){S?alert("Игра уже запущена"):(S=!0,k(),D(),n=setInterval(x,40),q()),A.play()})),document.addEventListener("DOMContentLoaded",(function(){document.querySelector(".menu-button").addEventListener("click",(function(){A.play(),setTimeout((function(){window.location.href="../index.html"}),350)}))}))})();
(()=>{let e,t,n,o=document.querySelector("canvas"),i=o.getContext("2d"),d=document.querySelector(".start"),l=document.querySelector(".score"),c=0,r=0,u=0,h=7,a=h,f=0,w=.02*o.width,s=w,m=20,y=40,p=[],g=document.querySelector(".block-1"),v=new Audio("../sounds/bonus.mp3"),M=new Audio("../sounds/game-over.mp3"),A=new Audio("../sounds/menu-button.mp3"),L=new Audio("../sounds/phone.mp3");L.loop=!0,L.play(),g.addEventListener("touchmove",(function(e){if(e.preventDefault(),!S||!E)return;let t=e.touches[0],n=t.clientX-S,o=t.clientY-E;Math.abs(n)>Math.abs(o)?n>0?(a=7,f=0):(a=-7,f=0):o>0?(a=0,f=7):(a=0,f=-7),S=null,E=null})),g.addEventListener("touchstart",(function(e){let t=e.touches[0];S=t.clientX,E=t.clientY}));let S=null,E=null;function b(){a=h*(o.width/800),f=h*(o.height/600)}function q(){(r>=o.width-w||r<0||u>=o.height-s||u<0)&&(M.play(),clearInterval(n),alert("Вы умерли, ваш счёт "+c),D()),i.clearRect(0,0,o.width,o.height),p.unshift({x:r,y:u}),p.length>y/w&&p.pop();for(let e=0;e<p.length;e++)i.fillRect(p[e].x,p[e].y,w,s);r=(r+a+o.width)%o.width,u=(u+f+o.height)%o.height,i.fillStyle="red",i.fillRect(e,t,m,m),r<e+m&&r+w>e&&u<t+m&&u+s>t&&(x(),y+=50,i.fillRect(p,u,w,s),c++,v.play(),R())}function x(){let n=o.width-m-20,i=o.height-m-20;t=Math.floor(Math.random()*i)+10,e=Math.floor(Math.random()*n)+10}function D(){c=0,h=7,a=h,f=0,r=0,u=0,p=[],y=40,R()}function R(){l.textContent=c%10==1&&c%100!=11?"Вы собрали "+c+" яблоко":c%10>=2&&c%10<=4&&!(c%100>=12&&c%100<=14)?"Вы собрали "+c+" яблока":"Вы собрали "+c+" яблок"}function k(){o.width=window.innerWidth,o.height=window.innerHeight,w=.02*o.width,s=.02*o.width,m=.03*o.width,e=Math.floor(Math.random()*o.width),t=Math.floor(Math.random()*o.height),b(),x()}i.fillStyle="green",window.addEventListener("resize",(function(){k(),x(),b(),n=setInterval(q,40)})),document.addEventListener("keydown",(function(e){e.preventDefault(),"KeyS"==e.code||"ArrowDown"==e.code?(f=7,a=0):"KeyD"==e.code||"ArrowRight"==e.code?(a=7,f=0):"KeyA"==e.code||"ArrowLeft"==e.code?(a=-7,f=0):"KeyW"!=e.code&&"ArrowUp"!=e.code||(f=-7,a=0)})),d.addEventListener("click",(function(){D(),k(),x(),n=setInterval(q,40),b(),A.play()})),document.addEventListener("DOMContentLoaded",(function(){document.querySelector(".menu-button").addEventListener("click",(function(){A.play(),setTimeout((function(){window.location.href="../index.html"}),350)}))}))})();